# -*- coding: utf-8 -*-
"""
Created on Sun Jun 18 13:32:45 2023

@author: lakshya
"""
import json
import re
def parse_cve_database(filename):
    with open(filename, 'r') as file:
        data = json.load(file)
        
    cve_items = data['CVE_Items']
    database = []
    for item in data['CVE_Items']:
        cve_id = item['cve']['CVE_data_meta']['ID']
        description = item['cve']['description'][0]['value']
        cpe_entries = item['configuration']['nodes']
        
        for entry in cpe_entries:
            if 'cpe_match' in entry:
                if 'cpe_match' in entry:
                    for match in entry['cpe_match']:
                        if match['vulnerable']:
                            cpe_uri = match['cpe23Uri']
                            service_name, version = extract_service_and_version_fromm_cpe(cpe_uri)
                            if service_name and version:
                                database.append((cve_id, service_name, version, description))
    
    return database

def extract_service_and_version_fromm_cpe(cpe_uri):
    try:
        service_name, versio = re.findall(r"cpe:2.3:a:(.*?):(.*?):.*", cpe_uri)[0]
    except IndexError:
        return None, None
    return service_name, version

database = parse_cve_database("C:\\Users\\lakshya\\Desktop\\CVE Database\\nvdcve-1.1-2023.json")